---
tag
 - Azure
 - Azure Database for PostgreSQL
---

Azure Database for PostgreSQL

世代 Gen 5(Intel E5-2673 v4 (Broadwell) 2.3 GHz)が主流
(※一部リージョンではGen4 Intel E5-2673 v3 (Haswell) 2.4 GHz)

IOPS:   ストレージが1秒あたりに処理できるI/Oアクセスの数


Basic:  低負荷なコンピューティング(仮想コア1～2)
        I/Oパフォーマンスは低い(開発・テスト・低使用頻度なアプリケーション)
        仮想コアあたり2GBメモリ
        ストレージ 5GB～1TB
        IOPS 保証なし

General(汎用):    負荷分散(仮想コア2,4,8,16,32,64)
            スケーラブルなI/O スループット(Webアプリなど通常用途)
            仮想コアあた5GBメモリ
            ストレージ 5GB～16TB
            IOPS 3/GB(ただし、最低100IOPS)

メモリ最適化:    高速トランザクションと高速な同時接続性(コンカレンシー)
                インメモリで動作するようなもの(リアルタイムデータや高パフォーマンスなトランザクションアプリ、分析アプリのためのサーバー)
                仮想コアあたり10GB
                ストレージ 5GB～16TB
	            IOPS 3/GB(ただし、最低100IOPS)


容量の上限に達した際には...？
ストレージが100GB以下... 
=> 空きストレージサイズ512MB未満 or 空きストレージサイズが5%未満なら読み取り専用に...
ストレージが100GBを超える
=> 空きストレージサイズが5GB未満なら読み取り専用に....


読み取り専用になると...?
・既存のセッションが全て切れる
・コミットしてないとロールバック
・予約されたトランザクションは失敗
・読み取りは成功

対策
・アラート！(こうならないために空容量が減ったらアラートを使おう！)
・ストレージの自動拡張機能

※ストレージだけはスケールアップはできてもスケールダウンはできないので注意！


バックアップストレージ
・プロビジョニングしたストレージの100%分の追加のストレージをバックアップ用に無料で確保できる
・超過分は従量課金


仮想コア
・同時接続数と強い関係
・Basicで仮想コア1つに対し約55接続(55n)
・汎用で55nくらい
・メモリ最適化で110nくらい(かなりアバウト...)


※仮想コア数が少ないサーバーを選択する場合は、ストレージが提供するすべての IOPS を使用できない可能性がある。
※アイドル状態の接続でもメモリを少し消費してしまう。
=>アイドル状態の接続を減らして、既存の接続を再利用する接続プーラーを用いる事で回避できる。


要調査
・バックアップの取り方
 - リテンション期間の話
 - 値段
 - 接続プーラーによる"アイドル状態の接続"の減少
 - IOPSと仮想コアの関係をもう少し詳しく